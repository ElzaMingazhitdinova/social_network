<!DOCTYPE html>
<html xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>User</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="vue">
        <h1 align="center">User: {{username}}</h1><br>
        <div style="text-align:center; margin:0 auto;">
            <select v-model="selected" @change="onSortingChange(selected)"><option v-for="s in sortingList">{{ s }}</option></select>

            <table align="center" cellspacing="30"><tbody><div class="large-12 medium-12 small-12 cell"><tr><th>Post</th><th>Category</th><th>Date</th></tr>

                <tr v-for="post in postList">
                    <td align="left">{{post.post}}</td>
                    <td><a v-bind:href="'localhost:8080/category?name='+ post.category">{{post.category}}</a></td>
                    <td>{{post.date}}</td>
                </tr>

            </div></tbody></table>
        </div>
    </div>
    <script type="text/javascript">
        const API_URL = 'http://127.0.0.1:8080';
        var app = new Vue({
            el:'#vue',
            data() {
                return {
                    username: "%s",
                    post: null,
                    postList: [],
                    sortingList: [],
                    selected: "",
                  };
              },
              computed: {
              },
              mounted() {
                  this.getSortings()
                  this.getPostList("")
              },
              methods: {
                  async getSortings(){
                      const sortingListResp = await this.sortingListRequest();
                      this.sortingList = sortingListResp.data.response;
                      this.selected = this.sortingList[0];
                  },

                  async getPostList(sorting) {
                      const postListResp = await this.postListRequest(sorting);
                      this.postList = postListResp.data.response;
                  },

                  async onSortingChange(sorting) {
                      console.log(sorting);
                      this.getPostList(sorting);
                      console.log(this.postList);
                  },

                  sortingListRequest() {
                      return axios({
                          method: 'get',
                          url: API_URL + '/sorting/list',
                          responseType: 'json',
                      })
                  },

                  postListRequest(sorting) {
                      if (sorting != ""){
                          sorting = "&sorting="+sorting
                      }
                      return axios({
                          method: 'get',
                          url: API_URL + '/post/list?username='+this.username+'&id=1'+sorting,
                          responseType: 'json',
                      })
                  }
              }
          });
        </script>
</body>
</html>
